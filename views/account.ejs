<!DOCTYPE html>
<html lang="en">

<head>
  <%- include('partials/head'); %>
    <title>Virtual Casino - Account</title>
    <script src="/js/account.js" defer></script>
</head>

<body>
  <%- include('partials/nav'); %>

    <h1>Welcome, <%= user.username %>
    </h1>

    <div class="pageContent">
      <section>
        <h2>Account Stats</h2>
        <ul>
          <li>Wallet: $<%= user.wallet %>
          </li>
          <li>Total Wins: <%= user.total_wins %>
          </li>
          <li>Total Profit: $<%= user.total_profit %>
          </li>
          <li>Total Money Invested: $<%= user.total_invested %>
          </li>
        </ul>
      </section>

      <section>
        <h2>Choose 3 Players</h2>
        <form action="/choosePlayers" method="POST">

          <div id="tableContainer">
            <table class="cpuTable">
              <thead>
                <tr>
                  <th>Select</th>
                  <th>Name</th>
                  <th>Confidence</th>
                  <th>Risk</th>
                  <th>Surrender Rate</th>
                </tr>
              </thead>
              <tbody id="cpuTableBody">
                <% cpus.forEach(cpu=> { %>
                  <tr>
                    <td>
                      <input type="checkbox" name="cpuIds[]" value="<%= cpu.cpuId %>" class="cpuCheck">
                    </td>
                    <td>
                      <%= cpu.name %>
                    </td>
                    <td>
                      <%= cpu.confidence %>
                    </td>
                    <td>
                      <%= cpu.risk %>
                    </td>
                    <td>
                      <%= cpu.surrenderRate %>
                    </td>
                  </tr>
                  <% }) %>
              </tbody>
            </table>
          </div>


          <div>
            <label for="betAmount">Bet Amount:</label>
            <input type="number" id="betAmount" name="betAmount" min="1" max="<%= user.wallet %>" step="1" required
              placeholder="Enter bet amount">
          </div>

          <p id="error" style="color:red; font-weight: bold;"></p>

          <button type="submit">Play Blackjack</button>
        </form>
      </section>

      <section>
        <h2>Recent History</h2>
        <% if (history.length===0) { %>
          <p>No games recorded yet.</p>
          <% } else { %>
            <table border="1" cellpadding="4">
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Result</th>
                  <th>Bet</th>
                  <th>Profit</th>
                </tr>
              </thead>
              <tbody>
                <% history.forEach(row=> { %>
                  <tr>
                    <td>
                      <%= row.played_at %>
                    </td>
                    <td>
                      <%= row.result %>
                    </td>
                    <td>$<%= row.bet_amount %>
                    </td>
                    <td>$<%= row.profit_change %>
                    </td>
                  </tr>
                  <% }); %>
              </tbody>
            </table>
            <% } %>
      </section>
    </div>
</body>

</html>